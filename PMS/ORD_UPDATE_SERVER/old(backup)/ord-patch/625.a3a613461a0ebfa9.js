"use strict";(self.webpackChunkord_patch=self.webpackChunkord_patch||[]).push([[625],{2625:(H,p,l)=>{l.r(p),l.d(p,{ExclusionsRoutingModule:()=>Q,ROUTES:()=>g});var m=l(6952),a=l(9808),u=l(2382),f=l(2539),C=l(5592),x=l(9524),d=l(7528),e=l(5e3),v=l(1135),b=l(5212),Z=l(6333),_=l(7751),E=l(3305),T=l(4667),A=l(9444);function M(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"div",5)(1,"h4",6),e._uU(2,"Supression Exclusion"),e.qZA(),e.TgZ(3,"button",7),e.NdJ("click",function(){return e.CHM(t).$implicit.dismiss("Cross click")}),e.qZA()(),e.TgZ(4,"div",8)(5,"p")(6,"strong"),e._uU(7,"\xcates-vous s\xfbr de vouloir supprimer l'exclusion ?"),e.qZA()(),e.TgZ(8,"p")(9,"span",9),e._uU(10,"Une notification sera envoy\xe9 aux administrateurs syst\xe8mes."),e.qZA()()(),e.TgZ(11,"div",10)(12,"button",11),e.NdJ("click",function(){return e.CHM(t).$implicit.dismiss("cancel click")}),e._uU(13,"Annuler"),e.qZA(),e.TgZ(14,"button",12),e.NdJ("click",function(){const i=e.CHM(t).$implicit,r=e.oxw();return i.close("Ok click"),r.supressionExclusion()}),e._uU(15,"Supprimer"),e.qZA()()}}function k(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"input",23),e.NdJ("ngModelChange",function(s){return e.CHM(t),e.oxw(2).temporaire=s}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("ngModel",t.temporaire)}}function y(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"input",24),e.NdJ("ngModelChange",function(s){return e.CHM(t),e.oxw(2).temporaire=s}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("ngModel",t.temporaire)}}function J(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"div",5)(1,"h4",6),e._uU(2,"Ajout d'une exclusion"),e.qZA(),e.TgZ(3,"button",7),e.NdJ("click",function(){return e.CHM(t).$implicit.dismiss("Cross click")}),e.qZA()(),e.TgZ(4,"div",8)(5,"p")(6,"strong"),e._uU(7,"Selection des serveurs: "),e.qZA()(),e.TgZ(8,"ngx-treeview",13),e.NdJ("filterChange",function(s){return e.CHM(t),e.oxw().onFilterChange(s)})("selectedChange",function(s){return e.CHM(t),e.oxw().values=s}),e.qZA(),e.TgZ(9,"div",14)(10,"div",15)(11,"strong",16),e._uU(12,"Temporaire: "),e.qZA()(),e.TgZ(13,"div",17)(14,"div",18),e.YNc(15,k,1,1,"input",19),e.YNc(16,y,1,1,"input",20),e._UZ(17,"label",21),e.qZA()()()(),e.TgZ(18,"div",10)(19,"button",11),e.NdJ("click",function(){return e.CHM(t).$implicit.dismiss("cancel click")}),e._uU(20,"Annuler"),e.qZA(),e.TgZ(21,"button",22),e.NdJ("click",function(){const i=e.CHM(t).$implicit,r=e.oxw();return i.close("Ok click"),r.creationExclusion()}),e._uU(22,"Cr\xe9er"),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(8),e.Q6J("config",t.config)("items",t.items_fullServeur),e.xp6(7),e.Q6J("ngIf","$KzGxqD&hAEtB32"==t.urlKey),e.xp6(1),e.Q6J("ngIf","$KzGxqD&hAEtB32"!=t.urlKey)}}function N(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"div",5)(1,"h4",6),e._uU(2,"Note de l'exclusion"),e.qZA(),e.TgZ(3,"button",7),e.NdJ("click",function(){return e.CHM(t).$implicit.dismiss("Cross click")}),e.qZA()(),e.TgZ(4,"div",8)(5,"label",25),e._uU(6,"Commentaire:"),e.qZA(),e.TgZ(7,"textarea",26),e.NdJ("ngModelChange",function(s){return e.CHM(t),e.oxw().comment=s}),e.qZA()(),e.TgZ(8,"div",10)(9,"button",11),e.NdJ("click",function(){return e.CHM(t).$implicit.dismiss("cancel click")}),e._uU(10,"Annuler"),e.qZA(),e.TgZ(11,"button",12),e.NdJ("click",function(){const i=e.CHM(t).$implicit,r=e.oxw();return i.close("Ok click"),r.CommenterExclusion()}),e._uU(12,"Commenter"),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(7),e.Q6J("ngModel",t.comment)}}function U(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"form")(1,"div")(2,"div",27)(3,"div",28)(4,"button",29),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(),i=e.MAs(3);return s.open(i)}),e._uU(5,"Ajouter une exception"),e.qZA()(),e.TgZ(6,"div",28)(7,"span",30),e._uU(8),e.qZA()()()()()}if(2&n){const t=e.oxw();e.xp6(8),e.hij("Maj des serveurs exclus: ",t.totalMajExclus,"")}}const S=function(){return["fas","delete-left"]};function q(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"td")(1,"button",36),e.NdJ("click",function(){e.CHM(t);const s=e.oxw().$implicit,i=e.oxw(2),r=e.MAs(1);return i.open(r),i.__id=s._id}),e._UZ(2,"fa-icon",38),e.qZA()()}2&n&&(e.xp6(2),e.Q6J("icon",e.DdM(2,S))("size","2x"))}const w=function(){return["fas","note-sticky"]};function F(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"tr")(1,"td"),e._UZ(2,"ngb-highlight",34),e.qZA(),e.TgZ(3,"td"),e._UZ(4,"ngb-highlight",35),e.qZA(),e.TgZ(5,"td"),e._UZ(6,"ngb-highlight",35),e.qZA(),e.TgZ(7,"td"),e._UZ(8,"ngb-highlight",35),e.qZA(),e.TgZ(9,"td")(10,"button",36),e.NdJ("click",function(){const i=e.CHM(t).$implicit,r=e.oxw(2),B=e.MAs(5);return r.open(B),r.__id=i._id,r.comment=i.comment}),e._UZ(11,"fa-icon",37),e.qZA()(),e.YNc(12,q,3,3,"td",3),e.ALo(13,"async"),e.qZA()}if(2&n){const t=c.$implicit,o=e.oxw().ngIf,s=e.oxw();e.xp6(2),e.Q6J("result",(o.indexOf(t)+1).toString()),e.xp6(2),e.Q6J("result",t.name),e.xp6(2),e.Q6J("result",t.description),e.xp6(2),e.Q6J("result",s.callback(t).toString()),e.xp6(3),e.Q6J("icon",e.DdM(8,w)),e.xp6(1),e.Q6J("ngIf",e.lcZ(13,6,s.auth.isAdmin)||"$KzGxqD&hAEtB32"==s.urlKey)}}function I(n,c){if(1&n&&(e.TgZ(0,"table",31)(1,"thead")(2,"tr")(3,"th",32),e._uU(4,"#"),e.qZA(),e.TgZ(5,"th",32),e._uU(6,"Nom"),e.qZA(),e.TgZ(7,"th",32),e._uU(8,"Description"),e.qZA(),e.TgZ(9,"th",32),e._uU(10,"Maj restantes"),e.qZA(),e._UZ(11,"th",32)(12,"th",32),e.qZA()(),e.TgZ(13,"tbody"),e.YNc(14,F,14,9,"tr",33),e.qZA()()),2&n){const t=c.ngIf;e.xp6(14),e.Q6J("ngForOf",t)}}let O=(()=>{class n{constructor(t,o,s,i){this.exclusionsService=t,this.serveursService=o,this.modalService=s,this.auth=i,this.serv=[],this.__id="",this.config=d.VF.create({hasAllCheckBox:!1,hasFilter:!0,hasCollapseExpand:!0,decoupleChildFromParent:!1,maxHeight:400}),this.closeResult="",this.temporaire=!0,this.totalMajExclus=0,this.matchMaj=[],this.comment=""}ngOnInit(){this.serveurs=this.exclusionsService.getExclusions(),this.serveurs$=this.serveursService.messerveurs$,this.getTreeItemsFullServeur(),this.serveurs.subscribe(t=>{this.serveurs$.subscribe(o=>{this.servs=o,this.totalMajExclus=0,t.forEach(s=>{let i=o.find(r=>r.fullName.match(s.name));null!=i&&(this.totalMajExclus+=i.kb_manquantes,s.kb_manquantes=i.kb_manquantes)})})})}callback(t){let o=this.servs.find(s=>s.fullName.match(t.name));return null!=o?o.kb_manquantes:"NaN"}getTreeItemsFullServeur(){const t=new d.cA({text:"serveurs",value:9,children:[{text:"Production",value:91,children:[{text:"",value:0,disabled:!0,checked:!1}],collapsed:!0},{text:"Pre-production",value:92,children:[{text:"",value:0,disabled:!0,checked:!1}],collapsed:!0},{text:"Recette-Formation",value:93,children:[{text:"",value:0,disabled:!0,checked:!1}],collapsed:!0},{text:"BDD",value:94,children:[{text:"",value:0,disabled:!0,checked:!1}],collapsed:!0},{text:"BDD-Recette",value:95,children:[{text:"",value:0,disabled:!0,checked:!1}],collapsed:!0},{text:"DMZ",value:96,children:[{text:"",value:0,disabled:!0,checked:!1}],collapsed:!0}]});return this.serveurs$.subscribe(o=>{this.serv=o,o.forEach(s=>{t.children.forEach(i=>{i.text==s.type&&i.children.push(new d.cA({text:s.name,value:i.value+101,checked:!1}))})}),this.items_fullServeur=[t]}),[t]}onFilterChange(t){console.log("filter:",t)}getCheckedItem(t){let o=[];return t[0].children.forEach(s=>{s.children.forEach(i=>{i.checked&&o.push(i.text)})}),o}creationExclusion(){let t=this.getCheckedItem(this.items_fullServeur),o=[];this.serv.forEach(s=>{t.includes(s.name)&&o.push({name:s.fullName,description:s.description,user:this.auth.user.value.name,temporaire:this.temporaire,_id:void 0,comment:""})}),this.exclusionsService.ajout(o,this.urlKey).subscribe(s=>{this.ngOnInit(),setTimeout(function(){alert(s)},1e3)})}supressionExclusion(){null!=this.__id&&""!=this.__id?this.exclusionsService.deleteExclusions(this.__id,this.auth.user.value.name,this.urlKey).subscribe(t=>{this.ngOnInit()}):console.log("error: _ID unfined")}CommenterExclusion(){null!=this.__id&&""!=this.__id?this.exclusionsService.commentExclusions(this.__id,this.comment,this.urlKey).subscribe(t=>{this.ngOnInit(),alert(t)}):console.log("error: _ID unfined")}open(t){this.modalService.open(t,{centered:!0}).result.then(o=>{this.closeResult=`Closed with: ${o}`},o=>{this.closeResult=`Dismissed ${this.getDismissReason(o)}`})}getDismissReason(t){return t===_.If.ESC?"by pressing ESC":t===_.If.BACKDROP_CLICK?"by clicking on a backdrop":`with: ${t}`}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(x.z),e.Y36(E.t),e.Y36(_.FF),e.Y36(T.g))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-exclusions-tab"]],inputs:{urlKey:"urlKey"},decls:10,vars:6,consts:[["content",""],["content_addExcl",""],["note",""],[4,"ngIf"],["class","table table-striped",4,"ngIf"],[1,"modal-header"],["id","modal-title",1,"modal-title"],["type","button","aria-describedby","modal-title",1,"btn-close",3,"click"],[1,"modal-body"],[1,"text-danger"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["type","button",1,"btn","btn-danger",3,"click"],[3,"config","items","filterChange","selectedChange"],[1,"row","align-items-center"],[1,"col"],[1,"mb-0"],[1,"col-auto"],[1,"custom-control","custom-switch"],["type","checkbox","class","custom-control-input","id","customSwitches","name","alertMail","disabled","",3,"ngModel","ngModelChange",4,"ngIf"],["type","checkbox","class","custom-control-input","id","customSwitches","name","alertMail",3,"ngModel","ngModelChange",4,"ngIf"],["for","customSwitches",1,"custom-control-label"],["type","button",1,"btn","btn-success",3,"click"],["type","checkbox","id","customSwitches","name","alertMail","disabled","",1,"custom-control-input",3,"ngModel","ngModelChange"],["type","checkbox","id","customSwitches","name","alertMail",1,"custom-control-input",3,"ngModel","ngModelChange"],["for","validationTextarea"],["id","validationTextarea","placeholder","Commentaire sur l'exclusion ...",1,"form-control",3,"ngModel","ngModelChange"],["role","toolbar","aria-label","Toolbar with button groups",1,"ml-2","btn-toolbar"],["role","group","aria-label","first group",1,"btn-group","me-2","ml-2"],["type","button",1,"btn","btn-outline-primary",3,"click"],[1,"ml-3"],[1,"table","table-striped"],["scope","col"],[4,"ngFor","ngForOf"],["Style","font-weight: bold",3,"result"],[3,"result"],[1,"delete",3,"click"],[3,"icon"],[3,"icon","size"]],template:function(t,o){1&t&&(e.YNc(0,M,16,0,"ng-template",null,0,e.W1O),e.YNc(2,J,23,4,"ng-template",null,1,e.W1O),e.YNc(4,N,13,1,"ng-template",null,2,e.W1O),e.YNc(6,U,9,1,"form",3),e.ALo(7,"async"),e.YNc(8,I,15,1,"table",4),e.ALo(9,"async")),2&t&&(e.xp6(6),e.Q6J("ngIf",e.lcZ(7,2,o.auth.isAdmin)||"$KzGxqD&hAEtB32"==o.urlKey),e.xp6(2),e.Q6J("ngIf",e.lcZ(9,4,o.serveurs)))},directives:[d.GA,a.O5,u.Wl,u.JJ,u.On,u.Fj,u._Y,u.JL,u.F,a.sg,_._h,A.BN],pipes:[a.Ov],styles:[".delete[_ngcontent-%COMP%]{border:0ch;background-color:unset}"]}),n})();function $(n,c){if(1&n&&(e.TgZ(0,"sb-card")(1,"div",2)(2,"div"),e._uU(3,"Serveurs Exclus"),e.qZA()(),e.TgZ(4,"div",3),e._UZ(5,"app-exclusions-tab",4),e.qZA()()),2&n){const t=c.ngIf;e.xp6(5),e.Q6J("urlKey",t)}}let h=(()=>{class n{constructor(t){this.route=t,this.urlKey=new v.X(" ")}ngOnInit(){this.route.params.subscribe(t=>{null!=t.urlKey&&this.urlKey.next(t.urlKey)})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(m.gz))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-exclusions"]],decls:3,vars:4,consts:[["title","Exclusions",3,"hideBreadcrumbs"],[4,"ngIf"],[1,"card-header","d-flex","justify-content-between","align-items-center"],[1,"card-body"],[3,"urlKey"]],template:function(t,o){1&t&&(e._UZ(0,"sb-dashboard-head",0),e.YNc(1,$,6,1,"sb-card",1),e.ALo(2,"async")),2&t&&(e.Q6J("hideBreadcrumbs",!1),e.xp6(1),e.Q6J("ngIf",e.lcZ(2,2,o.urlKey)))},directives:[b.T,a.O5,Z.A,O],pipes:[a.Ov],styles:[""]}),n})(),K=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({providers:[a.JJ,...x.u],imports:[[a.ez,m.Bz,u.UX,u.u5,f.n,C.A,d.X5.forRoot()]]}),n})();var D=l(6440);const g=[{path:"",canActivate:[],component:h,data:{title:"Exclusions - Patch Management",breadcrumbs:[{text:"Dashboard",link:"/patchManagement/dashboard"},{text:"Exclusions",active:!0}]}}];let Q=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[D.J,K,m.Bz.forChild(g)],m.Bz]}),n})()}}]);