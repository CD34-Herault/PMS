"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ItemBooleanAction = void 0;
const Action_1 = require("../../../../Action");
const ActionType_1 = require("../../../../actions/ActionType");
const misc_1 = require("../../../ber/decoder/misc");
class ItemBooleanAction extends Action_1.Action {
    constructor() {
        super(...arguments);
        this.type = ActionType_1.ActionType.TYPE_BOOLEAN;
    }
    transform(state) {
        const context = state.context;
        const length = misc_1.readLengthOctets(state);
        context.index++;
        if (length !== 1) {
            throw new Error('read boolean length must be one');
        }
        const value = state.dataview.getUint8(state.index);
        state.index++;
        context.index++;
        const key = Object.keys(context.current).length;
        // X.690 (8.2.2 and 11.1)
        if (value !== 0 && value !== 255) {
            throw new Error('This DER message do not respect X.690 11.1 clause');
        }
        context.current[key] = value !== 0;
        if (context.index === context.length) {
            // finish to read the sequence
            // should pop the state.
            state.nextAction = ActionType_1.ActionType.INIT;
            return;
        }
        state.nextAction = ActionType_1.ActionType.ITEM;
    }
}
exports.ItemBooleanAction = ItemBooleanAction;
//# sourceMappingURL=ItemBooleanAction.js.map